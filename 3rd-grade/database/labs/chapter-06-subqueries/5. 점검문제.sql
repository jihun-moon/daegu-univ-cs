-- ==================================================
-- 점검문제 1: 상관 서브쿼리 & WHERE절 서브쿼리
-- 목적: 사원 테이블에서 ‘배재용’ 사원의 부서명을 두 가지 방식으로 조회
-- ==================================================

-- [상관 서브쿼리]
SELECT 
    (SELECT 부서명
     FROM 부서 AS d
     WHERE d.부서번호 = e.부서번호
    ) AS 부서명
FROM 사원 AS e
WHERE 이름 = '배재용';

/*
[예상결과]
----------
| 부서명 |
----------
| 영업부 |
*/

-- [WHERE절에서의 서브쿼리]
SELECT 부서명
FROM 부서
WHERE 부서번호 = (
    SELECT 부서번호
    FROM 사원
    WHERE 이름 = '배재용'
);

/*
[예상결과]
----------
| 부서명 |
----------
| 영업부 |
*/


-- ==================================================
-- 점검문제 2: NOT EXISTS vs 외부 조인
-- 목적: 주문세부에 없는 제품(미판매 제품)을 조회하고 재고금액 계산
-- ==================================================

-- [NOT EXISTS를 이용한 서브쿼리]
SELECT 
    p.*,
    p.단가 * p.재고 AS 재고금액
FROM 제품 AS p
WHERE NOT EXISTS (
    SELECT *
    FROM 주문세부 AS d
    WHERE d.제품번호 = p.제품번호
);

/*
[예상결과]
---------------------------------------------------
| 제품번호 | 제품명 | 단가  | 재고 | 재고금액 |
---------------------------------------------------
| P004     | 젤리   | 500   | 0    | 0       |
| P006     | 껌     | 300   | 120  | 36000   |
*/

-- [LEFT OUTER JOIN을 이용한 외부 조인]
SELECT 
    제품.*,
    제품.단가 * 제품.재고 AS 재고금액
FROM 제품
LEFT OUTER JOIN 주문세부
  ON 제품.제품번호 = 주문세부.제품번호
WHERE 주문세부.제품번호 IS NULL;

/*
[예상결과]
---------------------------------------------------
| 제품번호 | 제품명 | 단가  | 재고 | 재고금액 |
---------------------------------------------------
| P004     | 젤리   | 500   | 0    | 0       |
| P006     | 껌     | 300   | 120  | 36000   |
*/


-- ==================================================
-- 점검문제 3: 인라인 뷰를 이용한 주문 요약 조회
-- 목적: 고객 테이블과 주문 요약(인라인 뷰)을 조인하여
--       각 고객의 주문건수, 최초·최종 주문일을 조회
-- ==================================================
SELECT 
    고객.담당자명,
    고객.고객회사명,
    주문요약.주문건수,
    주문요약.최초주문일,
    주문요약.최종주문일
FROM 고객,
     (
       SELECT 
           고객번호,
           COUNT(*)    AS 주문건수,
           MIN(주문일) AS 최초주문일,
           MAX(주문일) AS 최종주문일
       FROM 주문
       GROUP BY 고객번호
     ) AS 주문요약
WHERE 고객.고객번호 = 주문요약.고객번호;

/*
[예상결과]
----------------------------------------------------------------------------------
| 담당자명 | 고객회사명 | 주문건수 | 최초주문일    | 최종주문일    |
----------------------------------------------------------------------------------
| 홍길동   | ABC Corp   | 5        | 2020-01-10    | 2020-05-20    |
| 이순신   | DEF Corp   | 3        | 2020-02-05    | 2020-04-15    |
----------------------------------------------------------------------------------
*/
