-- Query 1: 지역 컬럼이 NULL인 행에 대해 도시별 고객수와 평균 마일리지 구하기 (ROLLUP 포함)
SELECT 도시,
       COUNT(*) AS 고객수,
       AVG(마일리지) AS 평균마일리지       
FROM 고객
WHERE 지역 IS NULL
GROUP BY 도시
WITH ROLLUP;
 
/*
[예상 결과]
--------------------------------------------------
| 도시         | 고객수 | 평균마일리지             |
--------------------------------------------------
| 서울특별시   | 20     | 5500                     |
| 부산         | 10     | 4800                     |
| 대구         | 5      | 5200                     |
| NULL         | 35     | 5320   -- 전체 합계 (ROLLUP 행, 도시 컬럼은 NULL)
--------------------------------------------------
*/

-- Query 2: 지역 컬럼이 NULL인 행에 대해 도시별 고객수와 평균 마일리지 구하기 (ROLLUP 행의 도시를 '총계'로 표시)
SELECT IFNULL(도시, '총계') AS 도시,
       COUNT(*) AS 고객수,
       AVG(마일리지) AS 평균마일리지       
FROM 고객
WHERE 지역 IS NULL
GROUP BY 도시
WITH ROLLUP;
 
/*
[예상 결과]
--------------------------------------------------
| 도시         | 고객수 | 평균마일리지             |
--------------------------------------------------
| 서울특별시   | 20     | 5500                     |
| 부산         | 10     | 4800                     |
| 대구         | 5      | 5200                     |
| 총계         | 35     | 5320   -- ROLLUP 행의 도시가 '총계'로 대체됨
--------------------------------------------------
*/

-- Query 3: 담당자직위에 '마케팅'이 포함된 고객을 대상으로 담당자직위와 도시별 고객수 구하기 (ROLLUP 포함)
SELECT 담당자직위,
       도시,
       COUNT(*) AS 고객수       
FROM 고객
WHERE 담당자직위 LIKE '%마케팅%'
GROUP BY 담당자직위, 도시
WITH ROLLUP;
 
/*
[예상 결과]
---------------------------------------------------------------
| 담당자직위      | 도시         | 고객수                      |
---------------------------------------------------------------
| 마케팅 담당자   | 서울특별시   | 8                           |
| 마케팅 담당자   | 부산         | 4                           |
| 마케팅 담당자   | NULL         | 12     -- '마케팅 담당자'의 도시별 소계
| NULL            | NULL         | 12     -- 전체 합계 (ROLLUP 최상위 행)
---------------------------------------------------------------
*/

-- Query 4: 담당자직위에 '대표 이사'가 포함된 고객을 대상으로 지역별 고객수와 그룹핑 여부(ROLLUP) 구하기
SELECT 지역,
       COUNT(*) AS 고객수,
       GROUPING(지역) AS 구분       
FROM 고객
WHERE 담당자직위 LIKE '%대표 이사%'
GROUP BY 지역
WITH ROLLUP;
 
/*
[예상 결과]
---------------------------------------------------------
| 지역       | 고객수 | 구분                           |
---------------------------------------------------------
| 서울       | 5      | 0   -- 일반 행 (지역별 데이터)   |
| 부산       | 3      | 0   -- 일반 행                   |
| NULL       | 8      | 1   -- ROLLUP 행 (전체 합계, 구분=1)
---------------------------------------------------------
*/

-- Query 5: 사원 테이블에서 모든 이름을 쉼표로 연결하여 하나의 문자열로 반환
SELECT GROUP_CONCAT(이름) AS 사원이름목록
FROM 사원;
 
/*
[예상 결과]
-------------------------------------------
| 사원이름목록                           |
-------------------------------------------
| '홍길동,이순신,유관순,김철수,박영희'      |
-------------------------------------------
*/

-- Query 6: 고객 테이블에서 중복 없이 지역 값을 쉼표로 연결하여 하나의 문자열로 반환
SELECT GROUP_CONCAT(DISTINCT 지역) AS 지역목록
FROM 고객;
 
/*
[예상 결과]
-------------------------------------------
| 지역목록            |
-------------------------------------------
| '서울,부산,대구,광주' |
-------------------------------------------
*/

-- Query 7: 도시별로 고객회사명을 쉼표로 연결하여 목록으로 반환
SELECT 도시, 
       GROUP_CONCAT(고객회사명) AS 고객회사명목록
FROM 고객
GROUP BY 도시;
 
/*
[예상 결과]
-------------------------------------------------------------
| 도시         | 고객회사명목록                                               |
-------------------------------------------------------------
| 서울특별시   | '대한상사,우리회사,삼성전자'                                   |
| 부산         | '부산상사,부산물산'                                             |
| 대구         | '대구무역,대구상사'                                             |
-------------------------------------------------------------
*/
