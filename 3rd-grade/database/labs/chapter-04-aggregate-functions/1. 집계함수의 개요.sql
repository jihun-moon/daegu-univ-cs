-- [고객 테이블: 집계 함수 사용 예시]

-- Query 1: 전체 행수와 특정 컬럼의 NULL 제외 개수 구하기
SELECT COUNT(*) AS 전체행수,       -- 모든 행을 카운트 (NULL 포함)
       COUNT(고객번호) AS 고객번호_개수,  -- 고객번호 컬럼: NULL 제외
       COUNT(도시) AS 도시_개수,    -- 도시 컬럼: NULL 제외
       COUNT(지역) AS 지역_개수     -- 지역 컬럼: NULL 제외
FROM 고객;

/*
예상 결과:
-----------------------------------------------------
| 전체행수 | 고객번호_개수 | 도시_개수 | 지역_개수  |
-----------------------------------------------------
| 100      | 95           | 90        | 80         |
-----------------------------------------------------
*/

------------------------------------------------------------

-- Query 2: 서울특별시에 해당하는 고객의 마일리지 집계
SELECT SUM(마일리지) AS 총마일리지,
       AVG(마일리지) AS 평균마일리지,
       MIN(마일리지) AS 최소마일리지,
       MAX(마일리지) AS 최대마일리지
FROM 고객
WHERE 도시 = '서울특별시';

/*
예상 결과:
-------------------------------------------------------------
| 총마일리지 | 평균마일리지 | 최소마일리지 | 최대마일리지  |
-------------------------------------------------------------
| 500000    | 5000         | 100          | 15000         |
-------------------------------------------------------------
*/

------------------------------------------------------------

-- Query 3: 도시별 고객 수와 평균 마일리지 구하기
SELECT 도시,
       COUNT(*) AS 고객수,
       AVG(마일리지) AS 평균마일리지
FROM 고객
GROUP BY 도시;  -- GROUP BY 1과 동일하게 '도시' 기준 그룹화

/*
예상 결과:
-------------------------------------------------------
| 도시         | 고객수 | 평균마일리지               |
-------------------------------------------------------
| 서울특별시   | 40     | 6000                       |
| 부산         | 20     | 4500                       |
| 대구         | 15     | 3000                       |
| 기타         | 25     | 3500                       |
-------------------------------------------------------
*/

------------------------------------------------------------

-- Query 4: 담당자직위와 도시별 고객 수 및 평균 마일리지 구하기
SELECT 담당자직위,
       도시,
       COUNT(*) AS '고객수',
       AVG(마일리지) AS '평균마일리지'
FROM 고객
GROUP BY 담당자직위, 도시
ORDER BY 담당자직위, 도시;

/*
예상 결과:
--------------------------------------------------------------
| 담당자직위   | 도시         | 고객수 | 평균마일리지              |
--------------------------------------------------------------
| 과장         | 서울특별시   | 10     | 7000                      |
| 과장         | 부산         | 5      | 5000                      |
| 부장         | 서울특별시   | 15     | 6000                      |
| 부장         | 대구         | 8      | 4000                      |
| 차장         | 기타         | 12     | 3500                      |
--------------------------------------------------------------
*/

------------------------------------------------------------

-- Query 5: 고객 수가 10명 이상인 도시만 선택하여 고객 수와 평균 마일리지 구하기
SELECT 도시,
       COUNT(*) AS '고객수',
       AVG(마일리지) AS '평균마일리지'
FROM 고객
GROUP BY 도시
HAVING COUNT(*) >= 10;

/*
예상 결과:
-------------------------------------------------------
| 도시         | 고객수 | 평균마일리지               |
-------------------------------------------------------
| 서울특별시   | 40     | 6000                       |
| 부산         | 20     | 4500                       |
-------------------------------------------------------
*/

------------------------------------------------------------

-- Query 6: 고객번호가 'T'로 시작하는 고객의 도시별 마일리지 총합 구하기
SELECT 도시,
       SUM(마일리지) AS 총마일리지
FROM 고객
WHERE 고객번호 LIKE 'T%'
GROUP BY 도시
HAVING SUM(마일리지) >= 1000;

/*
예상 결과:
-------------------------------------------------------
| 도시         | 총마일리지   |
-------------------------------------------------------
| 서울특별시   | 1500         |
| 대구         | 1200         |
-------------------------------------------------------
*/
